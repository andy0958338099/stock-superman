# 💬 討論功能系統設計

## 📅 更新時間：2025-11-19

---

## 🎯 **設計理念**

### **核心概念**
將討論功能設計為**頂級股市營業員的諮詢對話**，而非簡單的 Q&A。

### **目標**
- 從用戶的**模糊想法** → 引導到**明確的投資決策**
- 每一輪對話都有**不同的深度和角度**
- 第 5 輪給出**果斷、明確的結論**（無模糊說法）

---

## 🎭 **5 輪漸進式對話設計**

### **第 1 輪：傾聽者（理解與探索）**

#### **角色定位**
- 資深股市營業員（20 年經驗）
- 扮演「傾聽者」角色

#### **核心任務**
1. **重述論點**：用一句話總結用戶的核心觀點
2. **找出關鍵假設**：他的論點基於哪些假設？
   - 產業趨勢
   - 公司競爭力
   - 市場情緒
3. **探索性提問**：提出 2-3 個開放性問題，引導深入思考

#### **語氣風格**
- 溫和、專業、探索性
- 不批判，只理解

#### **AI 參數**
- Temperature: 0.7
- Max Tokens: 1200
- 字數：200-250 字

#### **範例輸出**
```
【重述論點】
您認為友達（2409）會上漲，主要是因為股價在 13 元附近，相對便宜。

【關鍵假設分析】
您的論點基於以下假設：
1. 價格便宜 = 投資價值高
2. 目前價位是相對低點
3. 未來有上漲空間

【探索性提問】
1. 您認為「便宜」的標準是什麼？是跟歷史股價比，還是跟產業平均比？
2. 除了價格，您有考慮過友達的營運狀況和產業趨勢嗎？
3. 如果股價繼續下跌到 10 元，您會怎麼看待這個投資？
```

---

### **第 2 輪：質疑者（挑戰與質疑）**

#### **角色定位**
- 資深股市營業員（見過太多投資者因忽略風險而虧損）
- 扮演「質疑者」角色

#### **核心任務**
1. **邏輯漏洞**：指出 2-3 個邏輯漏洞或過度樂觀/悲觀的地方
2. **反面證據**：提出可能與用戶觀點相反的市場證據或歷史案例
3. **風險提醒**：如果按照用戶的想法操作，可能面臨哪些風險？

#### **語氣風格**
- 犀利、批判性，但不失專業
- 直指核心問題

#### **AI 參數**
- Temperature: 0.8（更高的創造性，提出更多角度）
- Max Tokens: 1200
- 字數：250-300 字

#### **範例輸出**
```
【邏輯漏洞】
1. 「便宜」不等於「值得買」：友達股價從 100 元跌到 13 元，每個價位都有人覺得便宜
2. 忽略產業趨勢：面板產業供過於求，價格競爭激烈
3. 缺乏停損概念：如果繼續下跌，您的計畫是什麼？

【反面證據】
- 友達近 5 年 EPS 多為負值或微利
- 面板產業受到中國產能擴張衝擊
- 技術指標顯示仍在下跌趨勢中

【風險提醒】
如果現在進場，您可能面臨：
1. 繼續下跌的風險（產業基本面未改善）
2. 長期套牢的風險（缺乏明確的反轉訊號）
3. 機會成本（資金可能有更好的投資標的）
```

---

### **第 3 輪：教練（引導與啟發）**

#### **角色定位**
- 資深股市營業員（良師角色）
- 扮演「教練」角色

#### **核心任務**
1. **盲點揭示**：指出用戶可能忽略的 2-3 個重要因素
   - 技術面
   - 基本面
   - 籌碼面
   - 市場情緒
2. **新視角**：提供一個用戶可能沒想到的分析角度
   - 產業鏈上下游
   - 國際局勢
   - 資金流向
3. **框架建議**：建議用戶應該關注哪些關鍵指標來驗證論點

#### **語氣風格**
- 啟發性、引導性
- 像一位良師，幫助學生建立思考框架

#### **AI 參數**
- Temperature: 0.75
- Max Tokens: 1200
- 字數：250-300 字

#### **範例輸出**
```
【盲點揭示】
您可能忽略了以下重要因素：
1. 技術面：股價雖然便宜，但 KD、MACD 都在低檔鈍化，沒有反轉訊號
2. 基本面：友達 Q3 財報顯示營收年減 15%，毛利率持續下滑
3. 籌碼面：外資持續賣超，主力沒有明顯進場跡象

【新視角】
建議從「產業週期」角度思考：
- 面板產業是典型的景氣循環產業
- 目前處於產業低谷，但何時反轉不確定
- 可以關注面板價格指數（如 WitsView）作為領先指標

【框架建議】
建議您建立以下觀察框架：
1. 產業指標：面板價格是否止跌回升？
2. 公司營運：單季 EPS 是否轉正？
3. 技術指標：是否出現底部反轉型態（如 W 底、頭肩底）？

只有當這 3 個條件都滿足時，才考慮進場。
```

---

### **第 4 輪：分析師（全面分析）**

#### **角色定位**
- 資深股市營業員（專業分析師）
- 扮演「分析師」角色

#### **核心任務**
1. **技術面評估**：從技術指標角度，這支股票目前的狀態如何？
2. **基本面評估**：從公司營運、產業趨勢角度，長期投資價值如何？
3. **市場情緒評估**：目前市場對這支股票的情緒是什麼？籌碼面健康嗎？
4. **綜合評分**：給出一個 0-100 的綜合評分，並說明理由

#### **語氣風格**
- 專業、全面、客觀
- 像一份專業的研究報告

#### **AI 參數**
- Temperature: 0.7
- Max Tokens: 1200
- 字數：300-350 字

#### **範例輸出**
```
【技術面評估】
- 趨勢：下跌趨勢，尚未出現反轉訊號
- KD 指標：低檔鈍化（20 以下超過 2 個月）
- MACD：死亡交叉，空方力道仍強
- 支撐壓力：13 元是近期支撐，但若跌破可能測試 10 元
- 技術面評分：30/100（偏空）

【基本面評估】
- 營收：Q3 營收年減 15%，產業需求疲弱
- 獲利：近 4 季 EPS 累計 -0.5 元，虧損狀態
- 產業趨勢：面板供過於求，價格競爭激烈
- 長期價值：產業週期底部，但反轉時間不確定
- 基本面評分：35/100（產業逆風）

【市場情緒評估】
- 外資：近 3 個月持續賣超，累計賣超 5 萬張
- 投信：無明顯動作
- 自營商：小幅買超，但力道不強
- 散戶情緒：偏向觀望，成交量萎縮
- 市場情緒評分：25/100（偏冷）

【綜合評分】
30/100（不建議進場）

理由：技術面、基本面、市場情緒三方面都偏弱，缺乏明確的反轉訊號。
```

---

### **第 5 輪：決策者（明確結論）**

#### **角色定位**
- 資深股市營業員（決策者）
- 經過 4 輪討論，現在是時候給出明確的結論

#### **核心任務**
1. **最終判斷**：這支股票值得投資嗎？
   - 明確回答：值得 / 不值得 / 需要觀察
2. **操作建議**：
   - 如果值得：建議進場價位、停損點、目標價
   - 如果不值得：明確說明原因，建議替代方案
   - 如果需要觀察：列出 3 個關鍵觀察指標和觸發條件
3. **風險控管**：給出具體的風險控管建議
4. **一句話總結**：用一句話總結建議

#### **語氣風格**
- 果斷、明確、專業
- **不存在模糊不清的說法**

#### **AI 參數**
- Temperature: 0.6（更低的隨機性，更明確的結論）
- Max Tokens: 1200
- 字數：300-400 字

#### **範例輸出（不值得）**
```
【最終判斷】
不值得投資

【操作建議】
明確建議：不要進場

原因：
1. 產業基本面未改善，面板供過於求持續
2. 公司營運虧損，短期內難以轉虧為盈
3. 技術面無反轉訊號，下跌趨勢未改變
4. 市場情緒冷淡，缺乏資金關注

替代方案：
如果您想投資科技股，建議關注：
- 半導體產業（如台積電、聯發科）
- AI 相關概念股（如廣達、緯創）
這些產業趨勢向上，基本面較佳。

【風險控管】
如果您堅持要投資友達，建議：
1. 持倉比例：不超過總資金的 5%
2. 停損點：12 元（跌破立即出場）
3. 觀察期：設定 3 個月觀察期，若無起色立即停損

【一句話總結】
友達目前處於產業低谷且無反轉訊號，建議觀望或轉向其他更有潛力的標的。
```

#### **範例輸出（需要觀察）**
```
【最終判斷】
需要觀察，暫不進場

【操作建議】
關鍵觀察指標：
1. 面板價格指數連續 2 個月上漲
2. 友達單季 EPS 轉正
3. 股價突破 15 元並站穩（季線上揚）

觸發條件：
當以上 3 個條件都滿足時，可以考慮進場。

建議進場策略（當條件滿足時）：
- 進場價位：15-16 元（突破後回測不破）
- 停損點：13.5 元（跌破支撐立即出場）
- 目標價：20 元（第一目標）、25 元（第二目標）
- 持倉比例：10-15%

【風險控管】
1. 分批進場：不要一次 all-in，建議分 2-3 批進場
2. 嚴守停損：跌破 13.5 元立即出場，不要心存僥倖
3. 定期檢視：每月檢視產業趨勢和公司營運狀況

【一句話總結】
友達需等待產業反轉訊號，建議設定明確觀察指標，條件滿足再進場。
```

---

## 📊 **技術實作細節**

### **AI 參數設定**

| 輪次 | 角色 | Temperature | Max Tokens | 字數 |
|------|------|-------------|------------|------|
| 1 | 傾聽者 | 0.7 | 1200 | 200-250 |
| 2 | 質疑者 | 0.8 | 1200 | 250-300 |
| 3 | 教練 | 0.75 | 1200 | 250-300 |
| 4 | 分析師 | 0.7 | 1200 | 300-350 |
| 5 | 決策者 | 0.6 | 1200 | 300-400 |

### **討論歷史傳遞**
```javascript
const historyForAI = discussionHistory.map(h => ({
  user: h.user_opinion,
  ai: h.ai_analysis
}));

await analyzeUserOpinion(stockId, stockName, userOpinion, historyForAI);
```

### **輪次檢測**
```javascript
const currentRound = discussionHistory.length + 1;
const strategy = roundStrategies[Math.min(currentRound, 5)];
```

---

## 🎨 **用戶體驗設計**

### **回覆訊息格式**
```
💬 討論 1/5 - 傾聽者

【您的看法】
我認為這支股票會漲，因為他卡在13元很久了

【資深營業員回應】
[AI 分析內容]

━━━━━━━━━━━━━━━
💡 繼續討論或查看其他分析
```

### **第 5 輪完成後**
```
💬 討論 5/5 - 決策者

【您的看法】
[用戶最後的看法]

【資深營業員回應】
[明確的結論和操作建議]

━━━━━━━━━━━━━━━
✅ 討論完成！建議查看「📊 總評」整合所有分析
```

---

## 🧪 **測試場景**

### **場景 1：樂觀投資者**
```
用戶：我認為這支股票會漲，因為他卡在13元很久了

第 1 輪：理解用戶認為「盤整 = 即將突破」的假設
第 2 輪：質疑「盤整也可能是下跌中繼」
第 3 輪：引導關注成交量、籌碼面
第 4 輪：全面分析技術面、基本面、市場情緒
第 5 輪：給出明確結論（值得/不值得/需要觀察）
```

### **場景 2：悲觀投資者**
```
用戶：我擔心這支股票會跌，因為產業不好

第 1 輪：理解用戶對產業趨勢的擔憂
第 2 輪：提出「產業不好 ≠ 股票一定跌」的反例
第 3 輪：引導關注公司在產業中的競爭力
第 4 輪：分析公司相對產業的表現
第 5 輪：給出明確結論（是否應該避開或逢低布局）
```

---

## 🎯 **核心價值**

### **對用戶的價值**
1. **建立投資框架**：從模糊想法到清晰邏輯
2. **發現盲點**：看到自己沒想到的風險和機會
3. **明確決策**：第 5 輪給出可執行的操作建議

### **對系統的價值**
1. **差異化**：不是簡單的 Q&A，而是深度諮詢
2. **專業性**：展現頂級營業員的專業能力
3. **用戶黏性**：有價值的對話會讓用戶持續使用

---

**🎉 討論功能現在是一個真正的投資諮詢系統！**

