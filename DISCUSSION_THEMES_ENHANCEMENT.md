# 討論模式主題化改進文檔

## 📋 改進目標

### 用戶需求
> "我覺得交互討論有五個主題，因此在每一次所引導的內容都該不一樣，像這裡 4/5 是指第四次的問題，這樣子用戶才能沈浸的進行討論"

### 改進方向
- ✅ 為 5 輪討論設計不同的主題
- ✅ 每一輪提供不同的引導內容
- ✅ 根據輪次調整 AI 角色和回應方式
- ✅ 提升用戶的沈浸式討論體驗

---

## 🎯 5 輪討論主題設計

### **第 1 輪：初步看法**
- **角色**：傾聽者
- **目標**：理解用戶的核心論點和關鍵假設
- **引導範例**：
  - 我認為這支股票會漲，因為技術面轉強...
  - 我擔心這支股票會跌，因為基本面轉弱...
  - 我對這支股票的第一印象是...
- **AI 回應重點**：重述論點、找出關鍵假設、探索性提問

### **第 2 輪：風險評估**
- **角色**：風險顧問
- **目標**：挑戰用戶的風險評估，提出可能被忽略的風險
- **引導範例**：
  - 我最擔心的風險是產業競爭加劇...
  - 我認為最大的風險是政策變化...
  - 我對這支股票的疑慮是...
- **AI 回應重點**：風險盲點、反面證據、最壞情境

### **第 3 輪：機會分析**
- **角色**：機會分析師
- **目標**：引導用戶看到潛在機會和成長動能
- **引導範例**：
  - 我看到的機會是新產品即將推出...
  - 我認為最大的機會是市場需求增加...
  - 我對這支股票的期待是...
- **AI 回應重點**：機會盲點、新視角、催化劑

### **第 4 輪：進出場策略**
- **角色**：策略教練
- **目標**：評估和優化用戶的進出場策略
- **引導範例**：
  - 我會在價格跌到 500 元時買進...
  - 我的停損點設在 450 元...
  - 我的目標價是 600 元...
- **AI 回應重點**：策略評估、優化建議、執行計畫、風險控管

### **第 5 輪：最終決策**
- **角色**：決策顧問
- **目標**：給出明確的結論和操作建議
- **引導範例**：
  - 綜合考量後，我決定買進並持有 3 個月...
  - 綜合考量後，我決定先觀望等待更好時機...
  - 我的投資比例是...
- **AI 回應重點**：最終判斷、操作建議、風險控管、一句話總結

---

## 🔧 技術實現

### 1. **discussion-handler.js**
- 在 `handleDiscussionInit` 函數中定義 5 個討論主題
- 根據 `discussionCount` 動態生成不同的引導內容
- 在 `handleDiscussionOpinion` 函數中根據輪次顯示不同的角色和主題

### 2. **quick-reply-builder.js**
- 更新 `buildDiscussionPromptQuickReply` 函數，根據輪次提供不同的範例按鈕
- 更新 `buildContinueDiscussionQuickReply` 函數，在按鈕上顯示下一輪的主題

### 3. **deepseek.js**
- 更新 `analyzeUserOpinion` 函數中的 `roundStrategies`
- 為每一輪設計不同的角色、系統提示和任務
- 調整 AI 的回應方式和語氣

---

## 📊 用戶體驗流程

```
用戶查詢股票 2330
  ↓
點擊「💬 討論」
  ↓
【第 1 輪：初步看法】
  → 引導：請分享您的初步看法
  → 範例：我認為會漲 / 我認為會跌
  → AI 角色：傾聽者
  → AI 回應：重述論點、找出假設、探索性提問
  ↓
點擊「💬 風險評估 (1/5)」
  ↓
【第 2 輪：風險評估】
  → 引導：請分享您的風險評估
  → 範例：產業風險 / 政策風險
  → AI 角色：風險顧問
  → AI 回應：風險盲點、反面證據、最壞情境
  ↓
點擊「💬 機會分析 (2/5)」
  ↓
【第 3 輪：機會分析】
  → 引導：請分享您的機會分析
  → 範例：成長機會 / 市場機會
  → AI 角色：機會分析師
  → AI 回應：機會盲點、新視角、催化劑
  ↓
點擊「💬 進出場策略 (3/5)」
  ↓
【第 4 輪：進出場策略】
  → 引導：請分享您的進出場策略
  → 範例：買進策略 / 停損策略
  → AI 角色：策略教練
  → AI 回應：策略評估、優化建議、執行計畫
  ↓
點擊「💬 最終決策 (4/5)」
  ↓
【第 5 輪：最終決策】
  → 引導：請分享您的最終決策
  → 範例：買進決策 / 觀望決策
  → AI 角色：決策顧問
  → AI 回應：最終判斷、操作建議、風險控管
  ↓
點擊「📊 查看總評」
  ↓
【總評】
  → 整合所有討論內容
  → 給出綜合建議
```

---

## 🎯 改進效果

### 改進前
- ❌ 每一輪的引導內容都一樣
- ❌ 用戶不知道該討論什麼
- ❌ AI 回應缺乏層次感
- ❌ 討論體驗單調

### 改進後
- ✅ 每一輪有明確的主題和引導
- ✅ 用戶能夠循序漸進地思考投資決策
- ✅ AI 扮演不同角色，提供多角度分析
- ✅ 討論體驗更加沈浸和有層次
- ✅ 從初步看法 → 風險評估 → 機會分析 → 進出場策略 → 最終決策，形成完整的投資決策流程

---

## 📝 修改文件

| 文件 | 修改內容 | 狀態 |
|------|---------|------|
| `functions/handlers/discussion-handler.js` | 定義 5 個討論主題，根據輪次生成不同引導內容 | ✅ 完成 |
| `functions/quick-reply-builder.js` | 根據輪次提供不同的範例按鈕和主題提示 | ✅ 完成 |
| `functions/deepseek.js` | 更新 AI 角色和回應策略，匹配討論主題 | ✅ 完成 |

---

## 🚀 下一步

1. ⏳ 等待 Netlify 部署完成（約 2-3 分鐘）
2. 🧪 在 LINE 中測試完整的 5 輪討論流程
3. ✅ 驗證每一輪的引導內容和 AI 回應是否符合預期
4. ✅ 驗證用戶體驗是否更加沈浸和有層次

