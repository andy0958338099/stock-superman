# 📝 Changelog

## 2025-11-25 - Bug Fixes

### VIX / USD/TWD 顯示問題修復
- **問題**：VIX 恐慌指數和 USD/TWD 匯率顯示為 0.00
- **原因**：
  - VIX: API 欄位名稱是 `Close`（大寫），代碼使用 `close`（小寫）
  - USD/TWD: API 沒有 `close` 欄位，實際欄位是 `spot_sell`, `spot_buy`
- **修復**：
  - VIX: 更新欄位讀取邏輯，支援 `Close`, `close`, `Adj_Close`
  - USD/TWD: 改用 `spot_sell`（即期賣出匯率）
- **測試結果**：VIX 20.52 ✅, USD/TWD 31.49 ✅

### 台股 EPS/本益比顯示問題修復
- **問題**：台股股利和 EPS/本益比未顯示
- **原因**：
  - FinMind API 需要 `start_date` 和 `end_date` 參數
  - 股利資料排序錯誤（使用字串 `year` 而非日期 `date`）
- **修復**：
  - `TaiwanStockDividend`: 加上日期參數（最近 5 年）
  - `TaiwanStockFinancialStatements`: 加上日期參數（最近 2 年）
  - 改用 `date` 欄位排序，取得最新資料
- **測試結果**：股利 5.00 元（114年第1季）✅, EPS 61.20 ✅

### AI 分析語氣優化
- **問題**：分析中出現「字數統計」、「煽動性語氣」等後設資訊
- **修復**：
  - 移除 prompt 中的「唯恐天下不亂」、「語不驚人死不休」等指示
  - 改為「專業、有態度、基於事實」的分析風格
  - 明確要求不要在分析中提及字數統計、語氣說明等後設資訊
- **測試結果**：分析專業且無不當字眼 ✅

---

## 2025-11-20 - Optimization

### 專案結構優化
- 模組化 handlers（新聞、政治、討論、總評、美股）
- 統一錯誤處理和重試機制
- 優化快取策略（台股 12 小時、美股 6 小時）

### Rich Menu 功能
- 動態 Rich Menu 支援
- 每週問卷調查功能
- 自動更新市場情緒分數

### 效能改進
- 並行化 API 請求
- 圖表生成優化（QuickChart）
- 減少不必要的資料庫查詢

---

## 未來計劃

### 短期（本月）
- [ ] 添加單元測試
- [ ] 整合錯誤監控（Sentry）
- [ ] API 速率限制

### 長期（下季度）
- [ ] 支援更多技術指標（RSI、布林通道）
- [ ] 多語言支援
- [ ] 自選股追蹤功能

